---
title: "872Final.verson1"
author:
output: html_document
date: "2024-04-15"
---
\newpage
\tableofcontents 
\newpage
\listoftables 
\newpage
\listoffigures 
\newpage

```{r setup, include=FALSE}
# Set your working directory
library(tidyverse)
library(dplyr)
library(lubridate)
library(agricolae)
library(moments)
library(ggplot2)
library(ggspatial)
library(prettymapr)
library(GGally)
library(ggridges)
library(viridis)
library(RColorBrewer)
library(colormap)
library(ggthemes)
library(gganimate)
library(gapminder)
library(magick)
library(formatR)
library(sf)
library(leaflet)
library(leaflet.extras2)
library(mapview); mapviewOptions(fgb = FALSE)
library(here)
knitr::opts_chunk$set(tidy.opts=list(width.cutoff=80), tidy=TRUE)
knitr::opts_chunk$set(echo = TRUE)
options(scipen = 4)
sf::sf_use_s2(FALSE)

#Checking directory
here()

# Set your ggplot theme
Hope.theme <- theme_base()  + 
  theme(
    line = element_line(color = 'darkgreen', linewidth = 2),
    rect = element_rect(color = 'darkgreen'),
    text = element_text(size = 12, color = 'darkgreen', face = "italic"),
    
    plot.title = element_text(size = 14, color = 'darkgreen', face = "bold", margin=margin(b=8)),
    axis.text = element_text(size = 12, color = 'darkgreen', face = "italic"),
    
    axis.ticks = element_line(color = 'darkgreen'),
    panel.grid.major =  element_line(color='cornsilk3', size=0.5),
    panel.grid.minor =  element_blank(),
    
    plot.background = element_rect(fill = 'azure2'),
    panel.background =  element_rect(fill = 'azure2'),
    legend.background = element_rect(fill = 'azure2'),
    legend.key = element_rect(fill = 'azure2'),
    legend.title = element_text(size = 12, face = "bold"),
    legend.position = 'none',
    
    complete = TRUE)

# Set my theme as default theme
theme_set(Hope.theme)

# Load your datasets
fall.brief <- read.csv(here("Data/Raw/Atlantic brief squid-fall-survey-points-data.csv"), skip = 3, stringsAsFactors = TRUE)
summer.brief <- read.csv(here("Data/Raw/Atlantic brief squid-summer-survey-points-data.csv"), skip = 3,  stringsAsFactors = TRUE)
spring.brief <- read.csv(here("Data/Raw/Atlantic brief squid-spring-survey-points-data.csv"), skip = 3,  stringsAsFactors = TRUE)

#Data Processing
fall.brief <- mutate(fall.brief, Season = "Fall")
summer.brief <- mutate(summer.brief, Season = "Summer")
spring.brief <- mutate(spring.brief, Season = "Spring")
squids <- bind_rows(fall.brief, summer.brief, spring.brief)

class(squids$wtcpue)
squids <- filter(squids, wtcpue > 0)

#Write out processed data
write.csv(squids, row.names = FALSE, file = here("Data/Processed/squids.csv"))
```


# Rationale and Research Questions



\newpage

# Dataset Information



\newpage

# Exploratory Analysis 

```{r, message=FALSE}
ggpairs(squids, columns =c(3, 5, 6, 7, 8),  
  axisLabels = "show")
```

#Table 
#Three Variables
```{r}
depth.summary <- squids %>%
  summarise(Mean=mean(Depth), Median=median(Depth), Max=max(Depth), Min=min(Depth), Skewness=skewness(Depth))
wtcpue.summary <- squids %>%
  summarise(Mean=mean(wtcpue), Median=median(wtcpue), Max=max(wtcpue), Min=min(wtcpue), Skewness=skewness(wtcpue))
latitude.summary <- squids %>%
  summarise(Mean=mean(LAT), Median=median(LAT), Max=max(LAT), Min=min(LAT), Skewness=skewness(LAT))

variables.summary <- bind_rows(depth.summary, wtcpue.summary, latitude.summary)
rownames(variables.summary) <- c("Depth", "WTCPUE", "Latitude")

knitr::kable(variables.summary, caption = "Statistical Summary of Variables, Depth, WTCPUE, Latitude")
```
#WTCPUE by year
```{r}
wtcpue.yearly.summary <- squids %>%
  group_by(Year) %>% 
  summarise(Observations=length(wtcpue), Mean=mean(wtcpue), Median=median(wtcpue), Max=max(wtcpue), Min=min(wtcpue), Skewness=skewness(wtcpue))

knitr::kable(wtcpue.yearly.summary, caption = "Statistical Summary of WTCPUE by Year")
```
#WTCPUE by season
```{r}
wtcpue.seasonal.summary <- squids %>%
  group_by(Season) %>% 
  summarise(Observations=length(wtcpue), Mean=mean(wtcpue), Median=median(wtcpue), Max=max(wtcpue), Min=min(wtcpue), Skewness=skewness(wtcpue))

knitr::kable(wtcpue.seasonal.summary, caption = "Statistical Summary of WTCPUE by Season")
```



#Map
```{r}
squids.sf <- squids %>% 
 st_as_sf(coords = c('LON','LAT'),
           crs=4326)
```
```{r}
time.plot <- ggplot() +
  annotation_map_tile(type = "osm", zoom = 3) +
  geom_sf(data=squids.sf, aes(color = Depth, size = wtcpue)) +
  scale_size_continuous(range = c(1, 15), name = "WTCPUE") +
  scale_color_gradient(low="white", high = "navy")+
  labs(title = "Distribution Change of Atlantic Brief Squid over Years",
       caption = "Color: Depth, Size: WTCPUE") +
  theme_minimal()
time.plot

animated.plot <- time.plot + transition_time(Year) +
  labs(title = "Year: {round(frame_time)}")

animate(animated.plot, duration = 50, fps = 2, width = 800, height = 600)
```

# Assuming you have an sf object 'data' with columns 'year' and 'wtcpue'
# The 'year' column should be of type Date or POSIXct

# Create the leaflet map
m <- leaflet(squids) %>% addProviderTiles(providers$OpenStreetMap)

# Create a color palette for WTCPUE values
pal <- colorNumeric(palette = "viridis", domain = squids$wtcpue)

# Add the WTCPUE data to the map with colors representing the values
m <- m %>% addCircleMarkers(
  ~LON, ~LAT, 
  color = ~pal(wtcpue), 
  group = ~as.character(Year)
)

# Add the timeline and timeline control
m %>% addTimeslider(
  timelineVar = ~Year,
  timelineGroup = ~as.character(Year),
  timelineLabel = ~as.character(Year),
  timelineOpts = timelineOptions(
    loopButton = TRUE,
    playButton = TRUE,
    enablePlayback = TRUE
  )
)
```

\newpage

# Analysis



## Question 1: <insert specific question here and add additional subsections for additional questions below, if needed>

## Question 2: 




\newpage

# Summary and Conclusions


\newpage

# References
<add references here if relevant, otherwise delete this section> 
