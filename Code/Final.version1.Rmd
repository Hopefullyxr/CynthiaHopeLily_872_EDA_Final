---
title: "872Final.verson1"
author: "Cynthia Zhou, Hope Liu, Lily Zhang"
date: "2024-04-15"
output:
  html_document: default
  pdf_document: default
toc: true
---

\newpage
\tableofcontents 
\newpage
\listoftables 
\newpage
\listoffigures 
\newpage

```{r setup, include=FALSE}
# Set your working directory
library(tidyverse)
library(dplyr)
library(lubridate)
library(agricolae)
library(moments)
library(ggplot2)
library(ggspatial)
library(prettymapr)
library(GGally)
library(ggridges)
library(viridis)
library(RColorBrewer)
library(colormap)
library(ggthemes)
library(gganimate)
library(gapminder)
library(magick)
library(formatR)
library(sf)
library(leaflet)
library(leaflet.extras2)
library(mapview); mapviewOptions(fgb = FALSE)
library(here)
knitr::opts_chunk$set(tidy.opts=list(width.cutoff=80), tidy=TRUE)
knitr::opts_chunk$set(echo = TRUE)
options(scipen = 4)
sf::sf_use_s2(FALSE)

#Checking directory
here()

# Set your ggplot theme
Hope.theme <- theme_base()  + 
  theme(
    line = element_line(color = 'darkgreen', linewidth = 2),
    rect = element_rect(color = 'darkgreen'),
    text = element_text(size = 12, color = 'darkgreen', face = "italic"),
    
    plot.title = element_text(size = 14, color = 'darkgreen', face = "bold", margin=margin(b=8)),
    axis.text = element_text(size = 12, color = 'darkgreen', face = "italic"),
    
    axis.ticks = element_line(color = 'darkgreen'),
    panel.grid.major =  element_line(color='cornsilk3', size=0.5),
    panel.grid.minor =  element_blank(),
    
    plot.background = element_rect(fill = 'azure2'),
    panel.background =  element_rect(fill = 'azure2'),
    legend.background = element_rect(fill = 'azure2'),
    legend.key = element_rect(fill = 'azure2'),
    legend.title = element_text(size = 12, face = "bold"),
    legend.position = 'none',
    
    complete = TRUE)

# Set my theme as default theme
theme_set(Hope.theme)

# Load your datasets
fall.brief <- read.csv(here("Data/Raw/Atlantic brief squid-fall-survey-points-data.csv"), skip = 3, stringsAsFactors = TRUE)
summer.brief <- read.csv(here("Data/Raw/Atlantic brief squid-summer-survey-points-data.csv"), skip = 3,  stringsAsFactors = TRUE)
spring.brief <- read.csv(here("Data/Raw/Atlantic brief squid-spring-survey-points-data.csv"), skip = 3,  stringsAsFactors = TRUE)

#Data Processing
fall.brief <- mutate(fall.brief, Season = "Fall")
summer.brief <- mutate(summer.brief, Season = "Summer")
spring.brief <- mutate(spring.brief, Season = "Spring")
squids <- bind_rows(fall.brief, summer.brief, spring.brief)

class(squids$wtcpue)
squids <- filter(squids, wtcpue > 0)

#Write out processed data
write.csv(squids, row.names = FALSE, file = here("Data/Processed/squids.csv"))
```


# Rationale and Research Questions



\newpage

# Dataset Information

Table 1
```{r, message=F, warning=F, echo=F}
data.description <- data.frame(ItemName = c("Data Source","Item", "Retrieved From", "Variable Used", "Data Range"),
  Value = c("NOAA Distribution Mapping and Analysis Portal (DisMAP)", "Atlantic Brief Squid (Lolliguncula brevis) in Southeast US, Fall & Spring & Summer", "https://apps-st.fisheries.noaa.gov/dismap/DisMAP.html", "Lattitude, Longitude, Depth, Year, Weight Catch per unit Effort, Season", "1989~2019"))
colnames(data.description) <- c("Detail", "Description")

knitr::kable(data.description, caption = "Dataset Information", align = c("r", "l"))
```
\newpage

# Exploratory Analysis 

```{r, message=F, warning=F, echo=F}
plot1 <- ggpairs(squids, columns =c(3, 5, 6, 7, 8),  
  axisLabels = "show")
```

## 1.Table

Table 2: Three Variables
```{r, message=F, warning=F, echo=F}
depth.summary <- squids %>%
  summarise(Mean=mean(Depth), Median=median(Depth), Max=max(Depth), Min=min(Depth), Skewness=skewness(Depth))
wtcpue.summary <- squids %>%
  summarise(Mean=mean(wtcpue), Median=median(wtcpue), Max=max(wtcpue), Min=min(wtcpue), Skewness=skewness(wtcpue))
latitude.summary <- squids %>%
  summarise(Mean=mean(LAT), Median=median(LAT), Max=max(LAT), Min=min(LAT), Skewness=skewness(LAT))

variables.summary <- bind_rows(depth.summary, wtcpue.summary, latitude.summary)
rownames(variables.summary) <- c("Depth", "WTCPUE", "Latitude")

knitr::kable(variables.summary, caption = "Statistical Summary of Variables, Depth, WTCPUE, Latitude")
```


Table 3: WTCPUE by year
```{r, message=F, warning=F, echo=F}
wtcpue.yearly.summary <- squids %>%
  group_by(Year) %>% 
  summarise(Observations=length(wtcpue), Mean=mean(wtcpue), Median=median(wtcpue), Max=max(wtcpue), Min=min(wtcpue), Skewness=skewness(wtcpue))

knitr::kable(wtcpue.yearly.summary, caption = "Statistical Summary of WTCPUE by Year")
```


Table 4: WTCPUE by season
```{r, message=F, warning=F, echo=F}
wtcpue.seasonal.summary <- squids %>%
  group_by(Season) %>% 
  summarise(Observations=length(wtcpue), Mean=mean(wtcpue), Median=median(wtcpue), Max=max(wtcpue), Min=min(wtcpue), Skewness=skewness(wtcpue))

knitr::kable(wtcpue.seasonal.summary, caption = "Statistical Summary of WTCPUE by Season")
```


## 2. Graphing Change in Latitude

```{r alantitude, message=F, warning=F, echo=F}
# Spring
at_spr <- squids %>%
  filter(Season == "Spring") %>%
  group_by(Year) %>%
  summarise(
    mean_lat = mean(LAT, na.rm = TRUE),
    min_lat = min(LAT, na.rm = TRUE),
    max_lat = max(LAT, na.rm = TRUE),
    mean_cpu = mean(wtcpue, na.rm = TRUE),
    min_cpu = min(wtcpue, na.rm = TRUE),
    max_cpu = max(wtcpue, na.rm = TRUE),
    max_dep = max(Depth, na.rm = TRUE),
    mean_dep = mean(Depth, na.rm = TRUE)
  ) %>%
  ungroup()

# Summer
at_sum <- squids %>% 
  filter(Season == "Summer") %>%
  group_by(Year) %>%
  summarise(
    mean_lat = mean(LAT, na.rm = TRUE),
    min_lat = min(LAT, na.rm = TRUE),
    max_lat = max(LAT, na.rm = TRUE),
    mean_cpu = mean(wtcpue, na.rm = TRUE),
    min_cpu = min(wtcpue, na.rm = TRUE),
    max_cpu = max(wtcpue, na.rm = TRUE),
    mean_dep = mean(Depth, na.rm = TRUE),
    max_dep = max(Depth, na.rm = TRUE)
  ) %>%
  ungroup()

# Fall
at_fall <- squids %>% 
  filter(Season == "Fall") %>% 
   group_by(Year) %>%
  summarise(
    mean_lat = mean(LAT, na.rm = TRUE),
    min_lat = min(LAT, na.rm = TRUE),
    max_lat = max(LAT, na.rm = TRUE),
    mean_cpu = mean(wtcpue, na.rm = TRUE),
    min_cpu = min(wtcpue, na.rm = TRUE),
    max_cpu = max(wtcpue, na.rm = TRUE),
    mean_dep = mean(Depth, na.rm = TRUE),
    max_dep = max(Depth, na.rm = TRUE)
  ) %>%
  ungroup()

# Spring plot
ggplot(at_spr, aes(x = Year)) +
  geom_ribbon(aes(ymin = min_lat, ymax = max_lat), fill = "lightblue", alpha = 0.5) +
  geom_line(aes(y = mean_lat), color = "red") +
  geom_point(aes(y = mean_lat), color = "red") +
  labs(
    title = "Change in Latitude (Spring)",
    x = "Year",
    y = "Latitude"
  ) +
  theme(legend.position = "right")
  theme(plot.title = element_text(hjust = 0.5))

# Summer plot
ggplot(at_sum, aes(x = Year)) +
  geom_ribbon(aes(ymin = min_lat, ymax = max_lat), fill = "lightblue", alpha = 0.5) +
  geom_line(aes(y = mean_lat), color = "red") +
  geom_point(aes(y = mean_lat), color = "red") +
  labs(
    title = "Change in Latitude (Summer)",
    x = "Year",
    y = "Latitude"
  ) +
  theme(legend.position = "right")
  theme(plot.title = element_text(hjust = 0.5))

# Fall plot
ggplot(at_fall, aes(x = Year)) +
  geom_ribbon(aes(ymin = min_lat, ymax = max_lat), fill = "lightblue", alpha = 0.5) +
  geom_line(aes(y = mean_lat), color = "red") +
  geom_point(aes(y = mean_lat), color = "red") +
  labs(
    title = "Change in Latitude (Fall)",
    x = "Year",
    y = "Latitude"
  ) +
  xlim(1989, 2020) +
  theme(legend.position = "right")
  theme(plot.title = element_text(hjust = 0.5))

```

## 3. Maping

```{r, message=F, warning=F, echo=F}
squids.sf <- squids %>% 
 st_as_sf(coords = c('LON','LAT'),
           crs=4326)
```

```{r, message=F, warning=F, echo=T}
time.plot <- ggplot() +
  annotation_map_tile(type = "osm", zoom = 4) +
  geom_sf(data=squids.sf, aes(color = Depth, size = wtcpue)) +
  scale_size_continuous(range = c(1, 15), name = "WTCPUE") +
  scale_color_gradient(low="white", high = "navy")+
  labs(title = "Distribution Change of Atlantic Brief Squid over Years",
       caption = "Color: Depth, Size: WTCPUE") +
  theme_minimal()

animated.plot <- time.plot + transition_time(Year) +
  labs(title = "Year: {round(frame_time)}")

animate(animated.plot, duration = 50, fps = 1, width = 800, height = 600)
```
 


\newpage

# Analysis


## 1. Depth ~ Year
<insert specific question here and add additional subsections for additional questions below, if needed>

```{r, message=F, warning=F, echo=F}
at_sea <- squids %>%
  group_by(Season,Year) %>%
  mutate(mean_dep = mean(Depth, na.rm = TRUE)
  ) %>%
  ungroup()

# Seasonal plot
ggplot(at_sea, aes(x = Year, y=mean_dep, color = Season)) +
  geom_line() +
  geom_point() +
  labs(
    title = "Change in Depth",
    x = "Year",
    y = "Depth"
  ) +
  scale_y_reverse()+
  theme(plot.title = element_text(hjust = 0.5))+
  theme(legend.position = "right")
```

```{r, , message=F, warning=F, echo=F}
model1 <- lm(data = squids, Depth ~ Year)
summary(model1)
```


## 2. wtcpue ~ depth

```{r, message=F, warning=F, echo=F}
ggplot(data = squids, aes(y=Depth, x=wtcpue, color = Season))+
  geom_point(alpha=0.7,size=0.7)+
  scale_y_reverse()+
  labs(title = "Vertical Distribution of Atlantic Brief Squid",
       y = "Depth(m)",
       x = "Weight Count per Unit Effort")+
  theme(plot.title = element_text(hjust = 0.5))+
  theme(legend.position = "right")
  xlim(0,2)
```

```{r, message=F, warning=F, echo=F}
model2 <- lm(data = squids, wtcpue ~ Depth)
summary(model2)
```


## 3. wtcpue ~ year

```{r, message=F, warning=F, echo=F}
ggplot(data = squids, aes(y=wtcpue, x=Year, color = Season))+
  geom_point(alpha=0.7,size=0.7)+
  labs(title = "Atlantic Brief Squid",
       y = "Weight Count per Unit Effort",
       x = "Year")+
 theme(plot.title = element_text(hjust = 0.5))+
  theme(legend.position = "right")
```

```{r, message=F, warning=F, echo=F}
model3 <- lm(data = squids, wtcpue ~ Year)
summary(model3)
```


## 4. wtcpue ~ season

ONE-WAY ANOVA test

Null Hypothesis: There are no differences in the means of wtcpue among seasons.
Alternative Hypothesis: There are differences in the means of wtcpue among seasons.

```{r, , message=F, warning=F, echo=F}
anova_result <- aov(wtcpue ~ Season, data = squids)
summary(anova_result)
```

\newpage

# Summary and Conclusions

\newpage

# References
<add references here if relevant, otherwise delete this section> 
